ARG SCHEME=chibi
ARG IMAGE=chibi:head
FROM schemers/${IMAGE}
RUN apt-get update && apt-get install -y make libffi-dev
RUN mkdir ${HOME}/.snow && echo "()" > ${HOME}/.snow/config.scm
COPY --from=retropikzel1/compile-r7rs /cache /cache
WORKDIR /cache
RUN make install
WORKDIR /cache/chibi-scheme
RUN make install
COPY --from=retropikzel1/compile-r7rs /usr/local/share/snow /usr/local/share/snow
COPY --from=retropikzel1/compile-r7rs /usr/local/lib/snow /usr/local/lib/snow
WORKDIR /workdir
ARG SCHEME=chibi
ENV COMPILE_R7RS=${SCHEME}

